<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lectura - Blue Lock Capítulo 1 | TuComicOnline</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Puedes ajustar estilos específicos para el lector aquí si es necesario */
    #viewer-container {
      position: relative;
      text-align: center;
    }
    #comicImage {
      max-width: 100%;
      height: auto;
    }
    .navigation-buttons {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <h1>TuComicOnline</h1>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="upload.html">Subir cómic</a></li>
        <li><a href="explore.html">Explorar</a></li>
        <li><a href="profile.html">Perfil</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <a href="chapter.html?comic=blue_lock" class="back-button">← Volver a Capítulos</a>
    <div id="viewer-container">
      <img id="comicImage" src="" alt="Página del cómic">
    </div>
    <div class="navigation-buttons" style="text-align: center;">
      <button id="prevBtn" class="submit-button">Anterior</button>
      <button id="nextBtn" class="submit-button">Siguiente</button>
    </div>
  </main>

  <footer>
    <p>&copy; 2024 TuComicOnline. Todos los derechos reservados.</p>
  </footer>

  <!-- Firebase App (SDK principal) -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
  <!-- Firebase Storage -->
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-storage-compat.js"></script>
  
  <script>
    // Configuración de Firebase (Reemplaza con tu configuración)
    const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "tucomiconline-8015d.firebaseapp.com",
        projectId: "tucomiconline-8015d",
        storageBucket: "tucomiconline-8015d.appspot.com",
        messagingSenderId: "TU_MESSAGING_SENDER_ID",
        appId: "TU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    
    // Función para parsear parámetros de la URL
    function getQueryParams() {
      const params = {};
      const search = window.location.search.substring(1);
      if (search) {
        search.split("&").forEach(function(part) {
          const item = part.split("=");
          params[item[0]] = decodeURIComponent(item[1]);
        });
      }
      return params;
    }
    const queryParams = getQueryParams();
    // Valores por defecto (ajústalos según tu lógica)
    const comic = queryParams.comic || "blue_lock";
    const chapter = queryParams.chapter || "1";
    
    // Define la ruta en Storage para el capítulo (asegúrate de que coincida con tu estructura)
    const chapterPath = "BLUE LOCK/CAPITULO " + chapter + "/";
    
    let imageRefs = [];  // Array que contendrá las referencias de las imágenes
    let currentIndex = 0;
    
    // Función para cargar las imágenes del capítulo
    function loadImages() {
      const listRef = storage.ref(chapterPath);
      listRef.listAll().then((res) => {
        // Filtra solo archivos .jpg y ordena la lista numéricamente
        imageRefs = res.items.filter(item => item.name.toLowerCase().endsWith('.jpg'))
          .sort((a, b) => {
            const nameA = a.name.replace('.jpg','');
            const nameB = b.name.replace('.jpg','');
            // Extraemos el primer número: si es doble página, se usa el número antes del guion
            const numA = parseFloat(nameA.split('-')[0]);
            const numB = parseFloat(nameB.split('-')[0]);
            return numA - numB;
          });
          
        if (imageRefs.length > 0) {
          displayImage(currentIndex);
        } else {
          document.getElementById('viewer-container').innerHTML = "<p>No se encontraron imágenes.</p>";
        }
      }).catch((error) => {
        console.error("Error al listar las imágenes:", error);
      });
    }
    
    // Función para mostrar la imagen en el índice actual
    function displayImage(index) {
      const imgElement = document.getElementById("comicImage");
      imageRefs[index].getDownloadURL().then(url => {
        imgElement.src = url;
        // Si el nombre de la imagen contiene un '-' se considera doble página.
        if(imageRefs[index].name.includes("-")) {
          imgElement.classList.add("double-page");
          // Ajusta el estilo para doble página (puedes modificarlo en CSS también)
          imgElement.style.width = "100%";
        } else {
          imgElement.classList.remove("double-page");
          imgElement.style.width = "auto";
        }
      }).catch((error) => {
        console.error("Error al obtener la URL de la imagen:", error);
      });
    }
    
    // Botones de navegación
    document.getElementById("prevBtn").addEventListener("click", () => {
      if(currentIndex > 0) {
        currentIndex--;
        displayImage(currentIndex);
      }
    });
    document.getElementById("nextBtn").addEventListener("click", () => {
      if(currentIndex < imageRefs.length - 1) {
        currentIndex++;
        displayImage(currentIndex);
      }
    });
    
    // Inicia la carga de imágenes al cargar la página
    loadImages();
  </script>
</body>
</html>
